# データベース構造説明書

## 概要

このデータベース（`core`）は、ポーカー関連サービスのコンテンツ管理システムのためのデータベースです。
MySQL 8.4.5上で動作し、文字セットは`utf8mb4`を使用しています。

## データベース設計の特徴

- 全テーブルにおいて論理削除（`enabled`フラグ）を採用
- 作成日時（`created_at`）と更新日時（`updated_at`）の標準化
- 多言語対応を考慮したUnicodeサポート（utf8mb4）

## テーブル構成

### 管理者系テーブル（admin_*）

#### `admin_user`
- **目的**: 管理者ユーザーの管理
- **主キー**: `user_id` (varchar(20))
- **機能**: 
  - 管理者のログイン認証（パスワードハッシュ化）
  - アクセス履歴の管理
  - 組織別アクセス制御
- **特記事項**: masterユーザー、room_admin_01〜20、event_adminまで計22ユーザーが登録済み

#### `admin_user_org`
- **目的**: 管理者ユーザーと組織の関連付け
- **主キー**: `user_id`, `org_no`
- **機能**: 権限管理（`permission_bit_flag`によるビットフラグ制御）

#### `admin_announce`
- **目的**: 管理者向けお知らせの管理
- **主キー**: `announce_no` (auto increment)

#### `admin_org_action`
- **目的**: 組織別のアクション履歴記録
- **主キー**: `org_no`, `action_type`, `seq`
- **機能**: JSON形式でのアクション詳細記録

#### `admin_org_img`
- **目的**: 組織と画像の関連付け
- **主キー**: `org_no`, `img_no`

### ブランド・イベント系テーブル

#### `brand`
- **目的**: ポーカーブランドの管理
- **主キー**: `brand_no` (auto increment)
- **登録例**: JOPT、戦国ポーカーツアー、AJPC、WSOPなど20ブランド

#### `brand_event`
- **目的**: ブランドとイベントの関連付け
- **主キー**: `brand_no`, `event_no`

#### `event`
- **目的**: イベント情報の管理

### 店舗・組織系テーブル

#### `room`
- **目的**: ポーカールーム（店舗）情報の管理
- **主キー**: `room_no` (auto increment)
- **機能**: 
  - ライセンス情報（風営法、特定遊興）
  - 提携店舗フラグ
  - サービスタグによる分類
- **登録店舗**: アキバギルド、イケブクロギルド、GGPL系列など20店舗

#### `room_opening_hours`
- **目的**: 店舗の営業時間管理
- **主キー**: `room_no`, `dayofweek_no`

#### `room_pickup`
- **目的**: 店舗のピックアップアイテム表示管理
- **主キー**: `room_no`, `display_no`

#### `room_pickup_item`
- **目的**: 店舗で利用可能なピックアップアイテムの管理
- **主キー**: `room_no`, `pickup_item_no`

#### `room_book_pickup_item`
- **目的**: 日付指定のピックアップアイテム予約管理
- **主キー**: `room_no`, `book_start_date`, `display_no`
- **機能**: 
  - 予約開始日・終了日の管理
  - 表示番号（1, 2）による位置制御
  - ピックアップアイテムとの関連付け

#### `org`
- **目的**: 組織情報の管理

### ピックアップアイテム系テーブル

#### `pickup_item`
- **目的**: ピックアップアイテムの基本管理
- **主キー**: `pickup_item_no` (auto increment)
- **タイプ**: `tournament`, `pr`, `game`の3種類

#### `pickup_item_as_tournament`
- **目的**: トーナメント型ピックアップアイテムの詳細
- **機能**: 
  - 開始時間、参加費、定員管理
  - 優勝賞金、賞品設定
  - 参加者数の追跡

#### `pickup_item_as_pr`
- **目的**: PR型ピックアップアイテムの詳細
- **機能**: PRコンテンツの管理

#### `pickup_item_as_game`
- **目的**: ゲーム型ピックアップアイテムの詳細
- **機能**: 
  - リングゲーム、ルーレット、大富豪、ブラックジャック
  - 参加費、参加人数の管理

### オーナー系テーブル（owner_*）

#### `owner`
- **目的**: オーナー情報の管理

#### `owner_as_info`
- **目的**: オーナーの詳細情報

#### `owner_category`
- **目的**: オーナーのカテゴリー分類

#### `owner_category_photo`
- **目的**: オーナーカテゴリーの写真管理

#### `owner_html`
- **目的**: オーナー向けHTMLコンテンツ管理

#### `owner_ring_price`
- **目的**: オーナーのリングゲーム料金設定

#### `owner_ring_table`
- **目的**: オーナーのリングゲームテーブル管理

#### `owner_url`
- **目的**: オーナー関連URL管理

### トーナメント系テーブル

#### `tournament`
- **目的**: トーナメント情報の管理

#### `tournament_structure`
- **目的**: トーナメント構造の管理

#### `tournament_price`
- **目的**: トーナメント料金体系の管理

### コンテンツ管理系テーブル

#### `media`
- **目的**: メディアファイルの管理

#### `news`
- **目的**: ニュース記事の管理

#### `news_as_interview`
- **目的**: インタビュー型ニュース記事の詳細管理
- **主キー**: `news_no`
- **機能**: 
  - メイン画像の管理
  - URLスラッグの設定
  - インタビュー記事の特別属性

#### `html`
- **目的**: HTMLコンテンツの管理

#### `img`
- **目的**: 画像ファイルの管理

### タグ管理系テーブル（tag_*）

#### `tag`
- **目的**: タグの基本情報管理
- **機能**: 
  - カテゴリー別タグ分類（pref、region、room、service、table等）
  - 検索キーワードの管理
  - 並び順制御

#### `tag_content`
- **目的**: コンテンツとタグの関連付け（従来型）
- **主キー**: `search_type`, `ref_no`, `tag_no`

#### `tag_content`
- **目的**: コンテンツとタグの関連付け（新型）
- **主キー**: `content_type`, `content_no`, `tag_no`
- **機能**: 
  - イベント、メディア等のコンテンツとタグの関連付け
  - より柔軟なコンテンツタイプ対応

#### `tag_owner`
- **目的**: オーナー関連コンテンツとタグの関連付け
- **機能**: room、event、media、brandとタグの関連付け

### 共通系テーブル（cmn/）

#### `app_info`
- **目的**: アプリケーション設定情報の管理
- **主キー**: `info_key`

#### `cache_info`
- **目的**: キャッシュ情報の管理

#### `seq`
- **目的**: シーケンス番号の管理

## データの特徴

### 管理ユーザー
- masterユーザー: 全権限（permission_bit_flag: 929）
- room_admin系ユーザー: 限定権限（permission_bit_flag: 122）
- event_admin: イベント管理権限

### 店舗データ
- 20店舗が登録済み（関東中心のポーカールーム）
- 各店舗に8つのピックアップアイテムが割り当て

### ピックアップアイテム
- 合計160アイテム（各店舗8つ × 20店舗）
- 各店舗でトーナメント2つ、PR2つ、ゲーム4つの構成

### タグシステム
- 都道府県（pref）: 47都道府県完備
- 地域（region）: 6地域区分
- サービス（service）: 12種類のサービス分類
- テーブル（table）: ポーカーテーブルの人数分類

## 技術仕様

- **データベースエンジン**: InnoDB
- **文字セット**: utf8mb4
- **照合順序**: utf8mb4_unicode_ci / utf8mb4_0900_ai_ci
- **外部キー制約**: 無効化設定
- **自動更新**: updated_atフィールドでCURRENT_TIMESTAMP ON UPDATE

## 更新履歴

- **生成日時**: 2025-07-15 03:46:38 +0000
- **ダンプ作成元**: Sequel Ace バージョン 20094
- **対象データベース**: core@localhost
- **主要な追加内容**:
  - `event_admin`ユーザーの追加
  - `content_tag`テーブルの新設
  - `news_as_interview`テーブルの追加
  - `room_book_pickup_item`テーブルの正式名称確定 